{% extends "layout/base.html" %}

{% block title %}–ó–∞—è–≤–∫–∞ ‚Ññ{{ req.id if req else "‚Äî" }} ‚Äî –°–¢–û{% endblock %}

{% block content %}
{% set category_labels = {
    "sto": "–°–¢–û / –æ–±—â–∏–π —Ä–µ–º–æ–Ω—Ç",

    "wash_combo": "–ú–æ–π–∫–∞, –¥–µ—Ç–µ–π–ª–∏–Ω–≥, —Ö–∏–º—á–∏—Å—Ç–∫–∞",
    "wash": "–ú–æ–π–∫–∞",
    "detailing": "–î–µ—Ç–µ–π–ª–∏–Ω–≥",
    "dry_cleaning": "–•–∏–º—á–∏—Å—Ç–∫–∞",

    "tire": "–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂",
    "truck_tire": "–ì—Ä—É–∑–æ–≤–æ–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂",
    "maint": "–¢–û/ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",

    "road_tow": "–≠–≤–∞–∫—É–∞—Ü–∏—è",
    "road_fuel": "–¢–æ–ø–ª–∏–≤–æ",
    "road_unlock": "–í—Å–∫—Ä—ã—Ç–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è",
    "road_jump": "–ü—Ä–∏–∫—É—Ä–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å",
    "road_mobile_tire": "–í—ã–µ–∑–¥–Ω–æ–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂",
    "road_mobile_master": "–í—ã–µ–∑–¥–Ω–æ–π –º–∞—Å—Ç–µ—Ä",

    "diag": "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",
    "electric": "–ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫",
    "engine_fuel": "–î–≤–∏–≥–∞—Ç–µ–ª—å –∏ —Ç–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
    "mechanic": "–°–ª–µ—Å–∞—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
    "body_work": "–ö—É–∑–æ–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
    "welding": "–°–≤–∞—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
    "argon_welding": "–ê—Ä–≥–æ–Ω–Ω–∞—è —Å–≤–∞—Ä–∫–∞",
    "auto_glass": "–ê–≤—Ç–æ—Å—Ç–µ–∫–ª–æ",
    "ac_climate": "–ê–≤—Ç–æ–∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä –∏ —Å–∏—Å—Ç–µ–º—ã –∫–ª–∏–º–∞—Ç–∞",
    "exhaust": "–í—ã—Ö–ª–æ–ø–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
    "alignment": "–†–∞–∑–≤–∞–ª-—Å—Ö–æ–∂–¥–µ–Ω–∏–µ",

    "agg_turbo": "–¢—É—Ä–±–∏–Ω–∞",
    "agg_starter": "–°—Ç–∞—Ä—Ç–µ—Ä",
    "agg_generator": "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä",
    "agg_steering": "–†—É–ª–µ–≤–∞—è —Ä–µ–π–∫–∞",
    "agg_gearbox": "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á",
    "agg_fuel_system": "–¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
    "agg_exhaust": "–í—ã—Ö–ª–æ–ø–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
    "agg_compressor": "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä",
    "agg_driveshaft": "–ö–∞—Ä–¥–∞–Ω–Ω—ã–π –≤–∞–ª",
    "agg_motor": "–ú–æ—Ç–æ—Ä",

    "mech": "–°–ª–µ—Å–∞—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
    "elec": "–ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫",
    "body": "–ö—É–∑–æ–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
    "paint": "–ö—É–∑–æ–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
    "agg": "–ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–π —Ä–µ–º–æ–Ω—Ç"
} %}

{# status -> (label, border, bg, text) #}
{% set status_badges = {
    "new": ("–ù–æ–≤–∞—è", "border-sky-400/60", "bg-sky-500/10", "text-sky-200"),
    "sent": ("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞", "border-amber-400/60", "bg-amber-500/10", "text-amber-200"),
    "accepted_by_service": ("–ü—Ä–∏–Ω—è—Ç–∞ –°–¢–û", "border-emerald-400/60", "bg-emerald-500/10", "text-emerald-200"),
    "in_work": ("–í —Ä–∞–±–æ—Ç–µ", "border-violet-400/60", "bg-violet-500/10", "text-violet-200"),
    "done": ("–ó–∞–≤–µ—Ä—à–µ–Ω–∞", "border-emerald-400/60", "bg-emerald-500/10", "text-emerald-200"),
    "cancelled": ("–û—Ç–º–µ–Ω–µ–Ω–∞", "border-rose-400/60", "bg-rose-500/10", "text-rose-200"),
    "rejected_by_service": ("–ó–∞–∫—Ä—ã—Ç–∞ (–æ—Ç–∫–∞–∑ –°–¢–û)", "border-rose-400/60", "bg-rose-500/10", "text-rose-200")
} %}

{% set offer_status_labels = {
    "new": "–ù–æ–≤—ã–π",
    "accepted": "–ü—Ä–∏–Ω—è—Ç",
    "rejected": "–û—Ç–∫–ª–æ–Ω—ë–Ω"
} %}

{% set st = req.status if req else None %}
{% set cat_code = (req.service_category or req.category) if req else None %}
{% set badge = status_badges.get(st, ("‚Äî", "border-slate-700", "bg-slate-900/40", "text-slate-200")) %}
{% set is_done = st in ["done", "cancelled", "rejected_by_service"] %}
{% set is_closed = st in ["done", "cancelled", "rejected_by_service"] %}

<div class="max-w-3xl mx-auto px-3 pb-10">
    <div class="flex items-center justify-between gap-3 mb-4">
        <a href="/sc/{{ service_center.id }}/requests"
           class="text-xs text-slate-400 hover:text-slate-200 transition">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞—è–≤–∫–∞–º
        </a>

        <div class="text-xs text-slate-400">
            –°–¢–û: <span class="text-slate-200 font-semibold">{{ service_center.name }}</span>
        </div>
    </div>

    <div class="rounded-3xl border border-slate-800 bg-slate-950/70 shadow-xl overflow-hidden">
        <div class="p-5 border-b border-slate-800 flex items-start justify-between gap-3">
            <div>
                <p class="text-xs uppercase tracking-[0.25em] text-slate-400">–ó–∞—è–≤–∫–∞</p>
                <h1 class="text-xl font-bold text-slate-100 mt-1">
                    ‚Ññ{{ req.id if req else "‚Äî" }}
                </h1>
            </div>

            <div class="flex flex-col items-end gap-2">
                <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold border {{ badge[1] }} {{ badge[2] }} {{ badge[3] }}">
                    {{ badge[0] }}
                </span>

                {# ‚úÖ –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –°–¢–û #}
                {% if not is_done and req.service_center_id == service_center.id %}
                <div class="flex items-center gap-2">
                    {% if st == "accepted_by_service" %}
                    <form method="post" action="/sc/{{ service_center.id }}/requests/{{ req.id }}/set-in-work">
                        <button type="submit"
                                class="rounded-full bg-violet-500/20 px-4 py-2 text-xs font-semibold text-violet-100 border border-violet-500/30 hover:bg-violet-500/25 transition">
                            ‚ñ∂ –í —Ä–∞–±–æ—Ç—É
                        </button>
                    </form>
                    {% elif st == "in_work" %}
                    <form method="post" action="/sc/{{ service_center.id }}/requests/{{ req.id }}/set-done">
                        <button type="submit"
                                class="rounded-full bg-emerald-500/20 px-4 py-2 text-xs font-semibold text-emerald-100 border border-emerald-500/30 hover:bg-emerald-500/25 transition">
                            ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å
                        </button>
                    </form>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="p-5 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4">
                    <p class="text-xs uppercase tracking-[0.25em] text-slate-400 mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</p>
                    <p class="text-sm text-slate-100 font-semibold">
                        {{ category_labels.get(cat_code, cat_code) if cat_code else "‚Äî" }}
                    </p>
                </div>

                <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4">
                    <p class="text-xs uppercase tracking-[0.25em] text-slate-400 mb-2">–†–∞–¥–∏—É—Å</p>
                    <p class="text-sm text-slate-100 font-semibold">
                        {{ (req.radius_km ~ ' –∫–º') if req and req.radius_km else '‚Äî' }}
                    </p>
                </div>
            </div>

            <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4">
                <p class="text-xs uppercase tracking-[0.25em] text-slate-400 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</p>
                <p class="text-sm text-slate-200 whitespace-pre-wrap">
                    {{ req.description or "‚Äî" }}
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4">
                    <p class="text-xs uppercase tracking-[0.25em] text-slate-400 mb-2">–õ–æ–∫–∞—Ü–∏—è</p>
                    <p class="text-sm text-slate-200">
                        {% set addr = (req.address_text or req.address) if req else None %}
                        {% set lat = req.latitude if req else None %}
                        {% set lon = req.longitude if req else None %}
                        {% set map_url = ('https://maps.google.com/?q=' ~ lat ~ ',' ~ lon) if (lat is not none and lon is not none) else None %}

                        {% if addr %}
                            {{ addr }}
                        {% elif map_url %}
                            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {{ lat }}, {{ lon }}
                        {% else %}
                            ‚Äî
                        {% endif %}

                        {% if map_url %}
                            <a href="{{ map_url }}" target="_blank"
                               class="ml-2 text-xs text-emerald-300 hover:text-emerald-200 underline underline-offset-2">
                                –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                            </a>
                        {% endif %}
                    </p>
                </div>

                <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4">
                    <p class="text-xs uppercase tracking-[0.25em] text-slate-400 mb-2">–≠–≤–∞–∫—É–∞—Ü–∏—è / –≤—ã–µ–∑–¥</p>
                    <p class="text-sm text-slate-200">
                        {% if req.need_tow %}
                            –î–∞
                        {% else %}
                            –ù–µ—Ç
                        {% endif %}
                    </p>
                </div>
            </div>

            {% if req.car %}
            <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4">
                <p class="text-xs uppercase tracking-[0.25em] text-slate-400 mb-2">–ê–≤—Ç–æ–º–æ–±–∏–ª—å</p>
                <p class="text-sm text-slate-100 font-semibold">
                    {{ req.car.brand }} {{ req.car.model }} ({{ req.car.year }})
                </p>
            </div>
            {% endif %}

        </div>

        <div class="p-5 border-t border-slate-800">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">

                <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                <div class="space-y-4">

                    <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-4 space-y-3">
                        <p class="text-xs uppercase tracking-[0.25em] text-slate-400">
                            –°—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–∫–∏
                        </p>

                        <ul class="text-xs text-slate-300 space-y-1">
                            <li>–¢–µ–∫—É—â–∏–π: <span class="font-semibold">{{ badge[0] }}</span> <span class="opacity-70">({{ st }})</span></li>
                            {% if req.rejected_reason %}
                            <li>–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞: <span class="font-semibold">{{ req.rejected_reason }}</span></li>
                            {% endif %}
                        </ul>

                        <p class="text-[11px] text-slate-400">
                            –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞—è–≤–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –≤–∞—à–µ–º—É –°–¢–û.
                        </p>
                    </div>

                </div>

                <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å–≤—è–∑—å/–æ—Ç–∫–ª–∏–∫/–∑–∞–∫—Ä—ã—Ç–∏–µ -->
                <div class="space-y-6">

                    <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 space-y-3">
                        <p class="text-xs uppercase tracking-[0.25em] text-slate-400">
                            –°–≤—è–∑—å —Å –∫–ª–∏–µ–Ω—Ç–æ–º
                        </p>

                        {% if is_closed %}
                        <div class="w-full rounded-2xl bg-slate-800/50 text-slate-300 py-2.5 text-sm font-semibold text-center">
                            –ó–∞—è–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ ‚Äî –∫–Ω–æ–ø–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
                        </div>
                        {% else %}
                            {% if client_telegram_id %}
                            <button type="button"
                                      onclick="sendChatLinkAndClose('/sc/{{ service_center.id }}/requests/{{ req.id }}/send-chat-link', '{{ bot_username }}')"
                                      class="w-full inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-800 hover:bg-slate-700 text-slate-100 py-2.5 text-sm font-semibold transition">
                                üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É (Telegram)
                            </button>
                            <p class="mt-2 text-[11px] text-slate-400">
                                –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º –≤–∞–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–æ—Ç–µ —Å –∫–Ω–æ–ø–∫–æ–π, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä–æ–µ—Ç –ø—Ä—è–º–æ–π —á–∞—Ç.
                            </p>
                            {% else %}
                            <button type="button"
                                    class="w-full rounded-2xl bg-slate-800/60 text-slate-300 py-2.5 text-sm font-semibold cursor-not-allowed"
                                    disabled>
                                Telegram –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                            </button>
                            {% endif %}
                        {% endif %}
                    </div>

                    <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-4 space-y-3">
                        <p class="text-xs uppercase tracking-[0.25em] text-slate-400">
                            –í–∞—à –æ—Ç–∫–ª–∏–∫
                        </p>

                        {% if my_offer %}
                        <ul class="text-xs text-slate-300 space-y-1">
                            <li>–¶–µ–Ω–∞: <span class="font-semibold">{{ my_offer.price_text or my_offer.price or "‚Äî" }}</span></li>
                            <li>–°—Ä–æ–∫: <span class="font-semibold">{{ my_offer.eta_text or (my_offer.eta_hours ~ " —á.") or "‚Äî" }}</span></li>
                            {% if my_offer.comment %}
                            <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: <span class="font-semibold">{{ my_offer.comment }}</span></li>
                            {% endif %}
                            {% if my_offer.status %}
                            <li>–°—Ç–∞—Ç—É—Å: <span class="font-semibold">{{ offer_status_labels.get(my_offer.status, my_offer.status) }}</span></li>
                            {% endif %}
                        </ul>
                        {% endif %}

                        {# ‚úÖ –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–æ–º (accepted_by_service) –∏ –¥–∞–ª—å—à–µ ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞ –∑–∞–ø—Ä–µ—â–∞–µ–º #}
                        {% set offer_locked = req.status in ["accepted_by_service", "in_work", "done", "cancelled", "rejected_by_service"] %}

                        {% if not offer_locked and not is_done %}
                        <p class="text-sm text-slate-300">
                            {% if my_offer %}
                                –í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –æ—Ç–∫–ª–∏–∫. –í—ã –º–æ–∂–µ—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ.
                            {% else %}
                                –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ—Ç–∫–ª–∏–∫ –ø–æ —ç—Ç–æ–π –∑–∞—è–≤–∫–µ.
                            {% endif %}
                        </p>

                        <form method="post" action="/sc/{{ service_center.id }}/requests/{{ req.id }}/offer" class="space-y-3">
                            <div class="grid grid-cols-1 gap-3">
                                <div class="space-y-1.5">
                                    <label class="block text-xs font-semibold text-slate-300">
                                        –°—Ç–æ–∏–º–æ—Å—Ç—å (—Å–≤–æ–±–æ–¥–Ω–æ)
                                    </label>
                                    <input type="text" name="price_text"
                                           value="{{ (my_offer.price_text if my_offer else '') or (my_offer.price if my_offer else '') }}"
                                           required
                                           placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 5000 / –æ—Ç 5000 / 5000‚Äì7000 / –ø–æ—Å–ª–µ –æ—Å–º–æ—Ç—Ä–∞"
                                           class="w-full rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/40">
                                </div>
                                <div class="space-y-1.5">
                                    <label class="block text-xs font-semibold text-slate-300">
                                        –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Å—Ä–æ–∫ (—Å–≤–æ–±–æ–¥–Ω–æ)
                                    </label>
                                    <input type="text" name="eta_text"
                                           value="{{ (my_offer.eta_text if my_offer else '') or ((my_offer.eta_hours ~ ' —á.') if my_offer and my_offer.eta_hours else '') }}"
                                           required
                                           placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 15 –º–∏–Ω—É—Ç / 1 —á–∞—Å / –≤ —Ç–µ—á–µ–Ω–∏–µ 2-—Ö –¥–Ω–µ–π"
                                           class="w-full rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/40">
                                </div>
                            </div>

                            <div class="space-y-1.5">
                                <label class="block text-xs font-semibold text-slate-300">
                                    –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
                                </label>
                                <textarea name="comment" rows="4"
                                          class="w-full rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/40"
                                          placeholder="–£—Ç–æ—á–Ω–µ–Ω–∏—è, –¥–µ—Ç–∞–ª–∏, —á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Ü–µ–Ω—É...">{{ my_offer.comment if my_offer else '' }}</textarea>
                            </div>

                            <button type="submit"
                                    class="w-full rounded-2xl bg-emerald-600 hover:bg-emerald-500 text-white py-2.5 text-sm font-semibold transition">
                                {% if my_offer %}üîÑ –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫{% else %}üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫{% endif %}
                            </button>
                        </form>
                        {% else %}
                            <p class="text-sm text-slate-300">
                                {% if is_done %}
                                    –ó–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.
                                {% elif req.status == "accepted_by_service" %}
                                    –ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –≤–∞—à —Å–µ—Ä–≤–∏—Å ‚Äî –æ—Ç–∫–ª–∏–∫ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∏ –±–æ–ª—å—à–µ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è.
                                {% elif req.status == "in_work" %}
                                    –ó–∞—è–≤–∫–∞ –≤ —Ä–∞–±–æ—Ç–µ ‚Äî –æ—Ç–∫–ª–∏–∫ –±–æ–ª—å—à–µ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è.
                                {% else %}
                                    –û—Ç–∫–ª–∏–∫ –ø–æ —ç—Ç–æ–π –∑–∞—è–≤–∫–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
                                {% endif %}
                            </p>
                        {% endif %}

                        {% if error_message %}
                        <p class="text-xs text-rose-300">{{ error_message }}</p>
                        {% endif %}
                    </div>

                    {# ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –∑–∞—è–≤–∫–∏ (–æ—Ç–∫–∞–∑ –°–¢–û) + –ø—Ä–∏—á–∏–Ω–∞ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ –∑–∞—è–≤–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —ç—Ç–æ–º—É –°–¢–û –∏ –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞ #}
                    {% if not is_done and req.status in ["accepted_by_service", "in_work"] and (req.service_center_id == service_center.id) %}
                    <div class="rounded-2xl border border-rose-400/30 bg-rose-500/10 p-4 space-y-3">
                        <p class="text-xs uppercase tracking-[0.25em] text-rose-200/80">
                            –ó–∞–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É
                        </p>

                        <p class="text-sm text-slate-200">
                            –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –∑–∞—è–≤–∫–µ.
                        </p>

                        <form method="post" action="/sc/{{ service_center.id }}/requests/{{ req.id }}/reject" class="space-y-3">
                            <div class="space-y-1.5">
                                <label class="block text-xs font-semibold text-slate-300">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞</label>
                                <textarea name="reason" rows="3"
                                          class="w-full rounded-2xl border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:border-rose-300 focus:ring-1 focus:ring-rose-300/40"
                                          placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–∏–µ—Ö–∞–ª / –Ω–µ –ø—Ä–∏–≤–µ–∑–ª–∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ / –Ω–µ—Ç –∑–∞–ø—á–∞—Å—Ç–µ–π..."></textarea>
                            </div>

                            <button type="submit"
                                    class="w-full rounded-2xl bg-rose-600 hover:bg-rose-500 text-white py-2.5 text-sm font-semibold transition">
                                ‚õî –ó–∞–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É
                            </button>

                            <p class="text-[11px] text-rose-100/80">
                                –í–Ω–∏–º–∞–Ω–∏–µ: –∑–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –≤ —Å—Ç–∞—Ç—É—Å ‚Äú–ó–∞–∫—Ä—ã—Ç–∞ (–æ—Ç–∫–∞–∑ –°–¢–û)‚Äù.
                            </p>
                        </form>
                    </div>
                    {% endif %}

                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}
