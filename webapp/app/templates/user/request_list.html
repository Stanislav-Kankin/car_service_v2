{% extends "layout/base.html" %}

{% block title %}–ú–æ–∏ –∑–∞—è–≤–∫–∏ ‚Äî CarBot{% endblock %}

{% block content %}
<div class="mt-8 space-y-6">
    <div class="flex items-center justify-between gap-4">
        <div>
            <p class="text-xs uppercase tracking-[0.25em] text-emerald-400/80 mb-1">
                –ó–∞—è–≤–∫–∏
            </p>
            <h1 class="text-2xl font-semibold">
                –ú–æ–∏ –∑–∞—è–≤–∫–∏
            </h1>
            <p class="text-sm text-slate-300">
                –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–µ—Ä–≤–∏—Å—ã ‚Äî –æ—Ç –Ω–æ–≤—ã—Ö –¥–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö.
            </p>
        </div>
        <a href="/me/garage"
           class="inline-flex items-center gap-2 rounded-full border border-slate-700 px-4 py-2 text-xs font-semibold text-slate-200 hover:bg-slate-800 transition">
            ‚Üê –í –≥–∞—Ä–∞–∂
        </a>
    </div>

    {% if error_message %}
    <div class="rounded-2xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-100">
        {{ error_message }}
    </div>
    {% endif %}

    <div class="relative mt-2">
        <div class="absolute inset-0 rounded-3xl bg-slate-900/70 backdrop-blur-2xl border border-slate-800"></div>

        <div class="relative z-10 p-5 space-y-4">
            {% if requests %}
                <div class="flex items-center justify-between mb-2">
                    <p class="text-xs uppercase tracking-[0.25em] text-emerald-400/80">
                        –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: {{ requests|length }}
                    </p>
                    <a href="/me/requests/create"
                       class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-xs font-semibold text-slate-900 shadow-lg shadow-emerald-500/30 hover:bg-emerald-400 transition">
                        + –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞
                    </a>
                </div>

                <div class="space-y-3">
                    {% for r in requests %}
                        {% set status = r.status %}
                        {% set status_label = r.status_label %}
                        {% set cat = r.service_category %}
                        {% set cat_label = r.service_category_label %}
                        <a href="/me/requests/{{ r.id }}"
                           class="block group rounded-2xl border border-slate-800 bg-slate-900/80 p-4 hover:border-emerald-400/70 hover:bg-slate-900 transform hover:-translate-y-0.5 transition duration-200">
                            <div class="flex items-start justify-between gap-3">
                                <div class="space-y-1.5">
                                    <div class="flex items-center gap-2 text-xs text-slate-400">
                                        <span class="uppercase tracking-[0.18em] text-slate-500">
                                            –ó–∞—è–≤–∫–∞ ‚Ññ{{ r.id }}
                                        </span>
                                        {% if r.created_at %}
                                            <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                                            <span>
                                                {{ r.created_at[:10] }} {{ r.created_at[11:16] if r.created_at|length > 15 }}
                                            </span>
                                        {% endif %}
                                    </div>
                                    <div class="flex items-center gap-2 text-sm font-semibold text-slate-100">
                                        {% if cat == "sto" %}
                                            <span>üõ†</span>
                                        {% elif cat == "maint" %}
                                            <span>üß∞</span>
                                        {% elif cat == "mechanic" or cat == "mech" %}
                                            <span>‚öôÔ∏è</span>
                                        {% elif cat == "electric" or cat == "elec" %}
                                            <span>üîå</span>
                                        {% elif cat == "body" or cat == "paint" %}
                                            <span>üé®</span>
                                        {% elif cat == "tire" %}
                                            <span>üõû</span>
                                        {% elif cat == "wash" %}
                                            <span>üöø</span>
                                        {% elif cat == "agg" %}
                                            <span>‚ö°</span>
                                        {% else %}
                                            <span>üìç</span>
                                        {% endif %}
                                        <span>{{ cat_label or "–£—Å–ª—É–≥–∞" }}</span>
                                    </div>

                                    {% if r.address_text %}
                                    <p class="text-xs text-slate-400">
                                        {{ r.address_text }}
                                    </p>
                                    {% endif %}

                                    {% if r.description %}
                                    <p class="text-xs text-slate-400 line-clamp-2">
                                        {{ r.description }}
                                    </p>
                                    {% endif %}
                                </div>

                                <div class="flex flex-col items-end gap-2 text-xs">
                                    {% if status in ["new", "sent", "accepted_by_service", "in_work", "done"] %}
                                        <div class="flex flex-col items-end gap-1">
                                            {% if status == "new" %}
                                                <span class="rounded-full bg-emerald-500/10 border border-emerald-400/70 px-3 py-1 text-[11px] font-semibold text-emerald-200">
                                                    ‚óè {{ status_label }}
                                                </span>
                                                <span class="text-[11px] text-emerald-200/80">
                                                    –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –°–¢–û
                                                </span>
                                            {% elif status == "sent" %}
                                                <span class="rounded-full bg-sky-500/10 border border-sky-400/70 px-3 py-1 text-[11px] font-semibold text-sky-200">
                                                    ‚óè {{ status_label }}
                                                </span>
                                                <span class="text-[11px] text-sky-200/80">
                                                    –ñ–¥—ë–º –æ—Ç–∫–ª–∏–∫–æ–≤ –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤
                                                </span>
                                            {% elif status == "accepted_by_service" %}
                                                <span class="rounded-full bg-amber-500/10 border border-amber-400/70 px-3 py-1 text-[11px] font-semibold text-amber-200">
                                                    ‚óè {{ status_label }}
                                                </span>
                                                <span class="text-[11px] text-amber-200/80">
                                                    –°–µ—Ä–≤–∏—Å –≤–∑—è–ª –∑–∞—è–≤–∫—É –≤ —Ä–∞–±–æ—Ç—É
                                                </span>
                                            {% elif status == "in_work" %}
                                                <span class="rounded-full bg-amber-500/10 border border-amber-400/70 px-3 py-1 text-[11px] font-semibold text-amber-200">
                                                    ‚óè {{ status_label }}
                                                </span>
                                                <span class="text-[11px] text-amber-200/80">
                                                    –†–∞–±–æ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
                                                </span>
                                            {% elif status == "done" %}
                                                <span class="rounded-full bg-emerald-500/15 border border-emerald-400/80 px-3 py-1 text-[11px] font-semibold text-emerald-200">
                                                    ‚óè {{ status_label }}
                                                </span>
                                                <span class="text-[11px] text-emerald-200/90">
                                                    –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∏ –æ—Ç–∑—ã–≤
                                                </span>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <span class="rounded-full bg-slate-800/80 border border-slate-600 px-3 py-1 text-[11px] font-semibold text-slate-200">
                                            ‚óè {{ status_label or status }}
                                        </span>
                                    {% endif %}
                                    <span class="inline-flex items-center gap-1 text-[11px] text-slate-400 group-hover:text-emerald-300 transition">
                                        –û—Ç–∫—Ä—ã—Ç—å
                                        <span class="text-base leading-none">‚Üí</span>
                                    </span>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="py-10 text-center text-sm text-slate-300">
                    <p class="mb-2">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫.</p>
                    <p class="text-slate-500 mb-4">
                        –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É –Ω–∞ —Ä–µ–º–æ–Ω—Ç –∏–ª–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞.
                    </p>
                    <a href="/me/requests/create"
                       class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-6 py-2.5 text-sm font-semibold text-slate-900 shadow-lg shadow-emerald-500/30 hover:bg-emerald-400 transition">
                        + –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
